############################################################
# üíª BIOINFORM√ÅTICA - AN√ÅLISIS DE TEXTO Y PATRONES EN R
# Tema: Uso de grep(), grepl(), sub(), gsub(), stringr y regex
# Dataset: Titanic (Seaborn)
# Nivel: Primer semestre de Biotecnolog√≠a
############################################################

# Cargar librer√≠as y dataset --------------------------------
library(data.table)
library(stringr)
datos <- fread("https://raw.githubusercontent.com/mwaskom/seaborn-data/master/titanic.csv")

############################################################
# üß† EJERCICIO 1: B√öSQUEDA DE TEXTO CON grep()
############################################################

# Buscar clases que contengan "First"
grep("First", datos$class)
datos[grep("First", datos$class), ]

# Buscar nombres que contengan "Mr."
grep("Mr\\.", datos$who)
datos[grep("Mr\\.", datos$who), ]

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© devuelve grep()?
# 2. ¬øQu√© significa el s√≠mbolo "\\" dentro del patr√≥n "Mr\\."?
# 3. ¬øPor qu√© usamos el argumento value = TRUE a veces?

############################################################
# üß† EJERCICIO 2: FILTRAR CON grepl()
############################################################

# Filtrar solo las mujeres
mujeres <- datos[grepl("female", datos$sex), ]
head(mujeres)

# Filtrar nombres con "a" o "A"
con_a <- datos[grepl("[aA]", datos$who), ]
nrow(con_a)

# ‚ùì PREGUNTAS:
# 1. ¬øCu√°l es la diferencia entre grep() y grepl()?
# 2. ¬øQu√© significa el uso de [aA] en el patr√≥n?
# 3. ¬øQu√© tipo de valor devuelve grepl()?

############################################################
# üß† EJERCICIO 3: REEMPLAZO DE TEXTO CON gsub()
############################################################

datos$sexo_limpio <- gsub("male", "Masculino", datos$sex)
datos$sexo_limpio <- gsub("female", "Femenino", datos$sexo_limpio)
head(datos[, .(sex, sexo_limpio)])

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© diferencia hay entre sub() y gsub()?
# 2. ¬øQu√© hace gsub() si hay varias coincidencias del patr√≥n en un mismo texto?

############################################################
# üß† EJERCICIO 4: EXPRESIONES REGULARES AVANZADAS
############################################################

# Nombres que empiezan por M o S
grep("^(M|S)", datos$who, value = TRUE)

# Nombres que terminan con n
grep("n$", datos$who, value = TRUE)

# Vocal seguida de consonante
grep("[aeiou][bcdfghjklmnpqrstvwxyz]", datos$who, value = TRUE)

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© significa "^" y "$" en una expresi√≥n regular?
# 2. ¬øQu√© hace el operador "|" dentro del patr√≥n (M|S)?
# 3. ¬øQu√© representa el uso de los corchetes [ ]?

############################################################
# üß† EJERCICIO 5: USO DE LA LIBRER√çA stringr
############################################################

nombres_largos <- datos[str_length(datos$who) > 10, ]
head(nombres_largos)

contiene_man <- datos[str_detect(datos$who, "man"), ]
head(contiene_man)

datos$who_upper <- str_to_upper(datos$who)
head(datos[, .(who, who_upper)])

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© ventaja ofrece stringr sobre grep y sub?
# 2. ¬øQu√© hace la funci√≥n str_detect()?
# 3. ¬øC√≥mo podr√≠as combinar str_length() con filtros de dplyr?

############################################################
# ‚≠ê EJERCICIO EXTRA: LIMPIEZA DE TEXTO Y CATEGOR√çAS
############################################################

datos$origen <- sample(c("UK", "Usa", "usa", "U.K.", "England"), nrow(datos), replace = TRUE)

datos$origen_limpio <- gsub("usa|Usa", "USA", datos$origen)
datos$origen_limpio <- gsub("U\\.K\\.|England", "UK", datos$origen_limpio)

table(datos$origen, datos$origen_limpio)

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© hace el s√≠mbolo "|" entre palabras en la expresi√≥n?
# 2. ¬øPor qu√© se usa "\\." al buscar "U.K."?

############################################################
# üß© EJERCICIO 6: CLASIFICACI√ìN DE TEXTO CON CONDICIONALES
############################################################

datos$titulo <- ifelse(grepl("Mr\\.", datos$who), "Se√±or",
                ifelse(grepl("Mrs\\.", datos$who), "Se√±ora",
                ifelse(grepl("Miss\\.", datos$who), "Se√±orita", "Otro")))

table(datos$titulo)

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© significa el uso de \\ dentro de "Mr\\."?
# 2. ¬øC√≥mo podr√≠as agregar una categor√≠a ‚ÄúNi√±o‚Äù si aparece "Master."?

############################################################
# üß© EJERCICIO 7: EXTRACCI√ìN DE TEXTO CON regexpr() Y regmatches()
############################################################

patron <- "^[A-Z]"
coincidencias <- regexpr(patron, datos$who)
iniciales <- regmatches(datos$who, coincidencias)

datos$inicial <- iniciales
head(datos[, .(who, inicial)])

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© significa el s√≠mbolo "^"?
# 2. ¬øQu√© diferencia hay entre regexpr() y grep()?

############################################################
# üß© EJERCICIO 8: LIMPIEZA DE TEXTO CON trimws() Y tolower()
############################################################

set.seed(1)
datos$origen_ruidoso <- paste0(" ", toupper(sample(c("uk", "usa", "england"), nrow(datos), replace = TRUE)), " ")

datos$origen_limpio2 <- tolower(trimws(datos$origen_ruidoso))

table(datos$origen_ruidoso, datos$origen_limpio2)

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© hace trimws()?
# 2. ¬øCu√°l es la diferencia entre tolower() y toupper()?

############################################################
# üß© EJERCICIO 9: CREACI√ìN DE ETIQUETAS CON CONDICIONES Y TEXTO
############################################################

datos$etiqueta <- ifelse(grepl("Mr\\.", datos$who) & datos$class == "First", "Caballero de Primera",
                  ifelse(grepl("Mrs\\.", datos$who) & datos$class == "Second", "Dama de Segunda", "Otro"))

table(datos$etiqueta)

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© hace el s√≠mbolo "&" en las condiciones?
# 2. ¬øC√≥mo agregar√≠as ‚ÄúCaballero de Tercera‚Äù en esta clasificaci√≥n?

############################################################
# üß© EJERCICIO 10: EXTRACCI√ìN Y REEMPLAZO CON stringr
############################################################

r_names <- str_extract_all(datos$who, "r")
head(r_names)

datos$sexo_cod <- str_replace_all(datos$sex, c("female" = "F", "male" = "M"))
head(datos[, .(sex, sexo_cod)])

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© hace str_replace_all()?
# 2. ¬øQu√© significa el uso de "[aeiou]" dentro de str_extract_all()?

############################################################
# üß© EJERCICIO 11: B√öSQUEDA CON OR (|)
############################################################

grep("Mr|Mrs", datos$who, value = TRUE)

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© funci√≥n cumple el operador "|"?
# 2. ¬øC√≥mo modificar√≠as la expresi√≥n para buscar "man" o "woman"?

############################################################
# üß© EJERCICIO 12: CONTEO DE PATRONES REPETIDOS
############################################################

datos$conteo_a <- str_count(datos$who, "a")
head(datos[, .(who, conteo_a)])

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© hace str_count()?
# 2. ¬øC√≥mo podr√≠as contar todas las vocales en una sola expresi√≥n?

############################################################
# üß© EJERCICIO 13: SUBCONJUNTOS POR PATRONES DEFINIDOS
############################################################

palabra <- "Mrs"
subconjunto <- datos[grepl(palabra, datos$who), ]
head(subconjunto)

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© pasa si cambias el valor de palabra?
# 2. ¬øC√≥mo podr√≠as convertir esto en una funci√≥n en R?

############################################################
# üß© EJERCICIO 14: CREACI√ìN DE COLUMNAS CON mutate() Y stringr
############################################################

library(dplyr)

datos <- datos %>%
  mutate(
    tiene_M = str_detect(who, "M"),
    nombre_largo = str_length(who) > 10,
    mayusculas = str_to_upper(who)
  )

head(datos[, .(who, tiene_M, nombre_largo, mayusculas)])

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© hace str_detect()?
# 2. ¬øC√≥mo podr√≠as crear una nueva columna que indique si el nombre termina en ‚Äún‚Äù?

############################################################
# üß© EJERCICIO 15: RETO FINAL - LIMPIEZA Y AN√ÅLISIS DE TEXTO
############################################################

set.seed(42)
datos$nombres_ruidosos <- paste0(sample(c("", " "), nrow(datos), replace = TRUE),
                                 datos$who,
                                 sample(c("", " "), nrow(datos), replace = TRUE))

datos$nombres_limpios <- trimws(str_to_title(datos$nombres_ruidosos))

datos$longitud <- str_length(datos$nombres_limpios)
datos$vocales <- str_count(datos$nombres_limpios, "[aeiouAEIOU]")

summary(datos$longitud)
summary(datos$vocales)

# ‚ùì PREGUNTAS:
# 1. ¬øQu√© funci√≥n convierte la primera letra de cada palabra en may√∫scula?
# 2. ¬øQu√© representa el patr√≥n "[aeiouAEIOU]"?
# 3. ¬øC√≥mo podr√≠as encontrar los 5 nombres m√°s largos con arrange()?

############################################################
# üß© FIN DEL SCRIPT
############################################################







